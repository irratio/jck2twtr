#!/bin/sh

rsstail -z -P -n 0 -l -d -c -i 120 -u http://rss.juick.com/Irregular/blog | sed -ur 's|^Link: http://juick.com/Irregular/([0-9]*)|http://juick.com/\1\nhttp://i.juick.com/p/\1.jpg\nhttp://i.juick.com/p/\1-1.jpg\nhttp://i.juick.com/p/\1-2.jpg|' | sed -urn '{/^http:\/\/i.juick.com/{s|^http://i.juick.com[^ ]*|wget -q --spider "\0" \&\& echo "\0"|e;/^$/d};p}' | sed -ur '{/^$/d;s|^Description: ||;/^Title: @Irregular:/d;s|^Comments:.*||}' | sed -urn '/^$/{x;s/\n/ /g;p;d};H' |sed -ur '{s|<br />|. |g;s|\&mdash;|—|g;s|<a href="([^"]*)"[^>]*>[^<]*</a>|\1|g;s|<blockquote>[^<]*</blockquote>||g;s|<[^>]*>||g;s|[^ ]*\^W||ig}' | sed -ur '{s|([а-я])\1+|\1|gi;s|[аеиоуыэюяьъ]+([^ .,;:…!?-])|\1|gi;s|\. +[а-я]|\U\0|g;s|[.,;:…/—-]+ | |g;s|[«»"]||g;s| +| |g;s|^ +||;s|^http://juick.com[^ ]* (http://[^ ]*)$|\1|}' | tee -a j2twi.log | strip-post-to-twi.awk | xargs -I '{}' ttytter -norc -autosplit=cut -silent -linelength=480 -status='{}'
